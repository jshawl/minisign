#!/usr/bin/env ruby
# frozen_string_literal: true

require 'io/console'
require 'minisign'
require 'optparse'

Signal.trap('INT') { exit }

options = {}
op = OptionParser.new do |opts|
  opts.on('-G') do |g|
    options[:G] = g
  end
  opts.on('-R') do |r|
    options[:R] = r
  end
  opts.on('-C') do |c|
    options[:C] = c
  end
  opts.on('-W') do |w|
    options[:W] = w
  end
  opts.on('-f') do |f|
    options[:f] = f
  end
  opts.on('-sSECRET_KEY') do |s|
    options[:s] = s
  end
  opts.on('-pPUBLIC_KEY') do |p|
    options[:p] = p
  end
end

begin
  op.parse!
  raise OptionParser::InvalidOption if options.keys.empty?
rescue OptionParser::InvalidOption
  Minisign::CLI.usage
  puts ''
  Minisign::CLI.help
  exit 1
end

Minisign::CLI.generate(options) if options[:G]
Minisign::CLI.recreate(options) if options[:R]
Minisign::CLI.recreate(options) if options[:C]
